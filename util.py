import re
import hashlib

def attempt_decode(raw_data):
  """
  Decodes utf-8 or utf-8-sig encoded bytes.
  """
  try:
    data = raw_data.decode('utf-8')
  except:
    data = raw_data.decode('utf-8-sig')

  return data


def get_hash(code):
  """
  Given a string of source code (with comments removed),
  normalizes (by removing whitespace) and returns the MD5
  hash.
  """
  cleaned_code = re.sub(r"\s+", "", code)
  hasher = hashlib.md5()
  hasher.update(cleaned_code.encode('utf-8'))
  return hasher.hexdigest()
